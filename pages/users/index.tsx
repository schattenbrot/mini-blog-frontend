import axios from "axios";
import type { GetStaticProps, NextPage } from "next";
import { useTranslation } from "next-i18next";
import { serverSideTranslations } from "next-i18next/serverSideTranslations";
import Head from "next/head";
import Link from "next/link";
import { useRouter } from "next/router";
import { FormEventHandler } from "react";
import { useSelector } from "react-redux";
import Button from "../../components/base/Button";
import useInput from "../../hooks/useInput";
import { State } from "../../store";

import styles from "../../styles/pages/Users.module.scss";

const Users: NextPage = () => {
  const { user: userId } = useSelector((state: State) => state.users);
  const router = useRouter();
  const { t } = useTranslation();

  const { value: typedUserId, bind: bindTypedUserId } = useInput("");

  const searchHandler: FormEventHandler = async (event) => {
    event.preventDefault();

    try {
      await axios.get(`/users/${typedUserId}`);
      router.push("/users/" + typedUserId);
    } catch (err) {
      console.error("an error occurred");
    }
  };

  return (
    <>
      <Head>
        <title>User</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <div className={styles.container}>
        <h1>{t("users:pageTitle")}</h1>
        <Link href={`/users/${userId}`}>{t("users:selfDetailsLink")}</Link>
        <form onSubmit={searchHandler} className={styles["form"]}>
          <label htmlFor='typedUserId'>{t("users:searchLabel")}</label>
          <input
            type='text'
            name='typedUserId'
            id='typedUserId'
            {...bindTypedUserId}
          />
          <Button type='submit'>{t("users:searchButton")}</Button>
        </form>
      </div>
    </>
  );
};

export const getStaticProps: GetStaticProps = async ({ locale }) => {
  locale ?? "en";
  return {
    props: {
      ...(await serverSideTranslations(locale!, ["users"])),
    },
  };
};

export default Users;
